---
import { projects } from '@/data/portfolio';
import Modal from './Modal.astro';
---

<section id="projects" class="projects-section">
  <div class="container">
    <h2 class="section-title reveal">My Projects</h2>

    <div class="projects-grid">
      {
        projects.map((project) => (
          <div class="project-card reveal">
            <div class="project-image-wrapper">
              <img src={project.image} alt={project.title} class="project-image" loading="lazy" />
              <div class="project-overlay">
                <button class="view-project-btn" data-project-id={project.id} aria-label={`View details for ${project.title}`}>
                  View Details
                </button>
              </div>
            </div>

            <div class="project-content">
              <h3 class="project-title">{project.title}</h3>
              <p class="project-description">{project.description}</p>

              <div class="project-links">
                {project.githubUrl && (
                  <a href={project.githubUrl} class="project-link" target="_blank" rel="noopener noreferrer" aria-label={`View ${project.title} on GitHub`}>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 32 32">
                      <path
                        fill="currentColor"
                        fill-rule="evenodd"
                        d="M16 0a16 16 0 0 0-5 31.2c.7.1 1-.4 1-.8v-2.8c-4.4 1-5.4-2-5.4-2-.7-2-1.7-2.4-1.7-2.4-1.5-1 0-1 0-1 1.7.1 2.5 1.7 2.5 1.7 1.4 2.4 3.8 1.7 4.7 1.3a3 3 0 0 1 1-2.1c-3.6-.4-7.3-1.8-7.3-8 0-1.7.6-3.1 1.6-4.2-.1-.4-.7-2 .2-4.3 0 0 1.3-.4 4.4 1.7a15.3 15.3 0 0 1 8 0c3-2.1 4.4-1.7 4.4-1.7.9 2.2.3 3.9.2 4.3 1 1 1.6 2.5 1.6 4.3 0 6.1-3.7 7.5-7.3 7.9.6.4 1.1 1.4 1.1 2.9v4.4c0 .5.3 1 1 .8A16 16 0 0 0 16 0z"
                        clip-rule="evenodd"
                      />
                    </svg>
                    GitHub
                  </a>
                )}
                {project.demoUrl && (
                  <a href={project.demoUrl} class="project-link" target="_blank" rel="noopener noreferrer" aria-label={`View ${project.title} live demo`}>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" />
                      <polyline points="15 3 21 3 21 9" />
                      <line x1="10" y1="14" x2="21" y2="3" />
                    </svg>
                    Live Demo
                  </a>
                )}
              </div>
            </div>
          </div>
        ))
      }
    </div>
  </div>
</section>

<Modal id="project-modal" size="large" ariaLabelledBy="project-modal-title" />

<style>
  .projects-section {
    min-height: 100vh;
    display: flex;
    align-items: center;
    padding: var(--space-12) 0;
    background-color: var(--color-bg-tertiary);
  }

  .section-title {
    text-align: center;
    margin-bottom: var(--space-10);
    font-size: var(--font-size-4xl);
    color: var(--color-text-primary);
  }

  .projects-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: var(--space-6);
    max-width: 1200px;
    margin: 0 auto;
  }

  .project-card {
    background-color: var(--color-bg-primary);
    border-radius: var(--border-radius-lg);
    overflow: hidden;
    box-shadow: var(--shadow-md);
    transition:
      transform var(--transition-base),
      box-shadow var(--transition-base);
    border: 1px solid var(--color-border);
  }

  .project-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-xl);
  }

  .project-image-wrapper {
    position: relative;
    overflow: hidden;
    aspect-ratio: 16 / 9;
  }

  .project-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform var(--transition-slow);
  }

  .project-card:hover .project-image {
    transform: scale(1.05);
  }

  .project-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity var(--transition-base);
  }

  .project-card:hover .project-overlay {
    opacity: 1;
  }

  .view-project-btn {
    background-color: var(--color-accent);
    color: var(--color-bg-dark);
    border: none;
    padding: var(--space-3) var(--space-6);
    border-radius: var(--border-radius-md);
    font-size: var(--font-size-base);
    font-weight: var(--font-weight-semibold);
    cursor: pointer;
    transition: transform var(--transition-fast);
  }

  .view-project-btn:hover {
    transform: scale(1.05);
  }

  .project-content {
    padding: var(--space-5);
  }

  .project-title {
    font-size: var(--font-size-xl);
    margin-bottom: var(--space-3);
    color: var(--color-text-primary);
  }

  .project-description {
    color: var(--color-text-secondary);
    line-height: var(--line-height-relaxed);
    margin-bottom: var(--space-4);
  }

  .project-links {
    display: flex;
    gap: var(--space-3);
    flex-wrap: wrap;
  }

  .project-link {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-2) var(--space-4);
    background-color: var(--color-bg-secondary);
    color: var(--color-text-primary);
    border-radius: var(--border-radius-md);
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    transition: background-color var(--transition-fast);
    border: 1px solid var(--color-border);
  }

  .project-link:hover {
    background-color: var(--color-primary);
    color: white;
  }

  @media (max-width: 768px) {
    .projects-grid {
      grid-template-columns: 1fr;
    }
  }
</style>

<script>
  import { projects } from '@/data/portfolio';

  // Wait for DOM and Modal class to be ready
  document.addEventListener('DOMContentLoaded', () => {
    // Initialize modal instance
    const projectModal = new (window as any).Modal('project-modal', {
      size: 'large',
      ariaLabelledBy: 'project-modal-title',
    });

    const viewProjectBtns = document.querySelectorAll('.view-project-btn');

    viewProjectBtns.forEach((btn) => {
      btn.addEventListener('click', () => {
        const projectId = btn.getAttribute('data-project-id');
        const project = projects.find((p) => p.id === projectId);

        if (project) {
          const content = `
          <img 
            src="${project.image}" 
            alt="${project.title}"
            style="width: 100%; border-radius: var(--border-radius-lg); margin-bottom: var(--space-6);"
          />
          <h2 id="project-modal-title" style="margin-bottom: var(--space-3); color: var(--color-text-primary);">
            ${project.title}
          </h2>
          <p style="color: var(--color-text-secondary); margin-bottom: var(--space-6); line-height: var(--line-height-relaxed);">
            ${project.description}
          </p>
          
          <h3 style="margin-bottom: var(--space-3); color: var(--color-text-primary);">Role:</h3>
          <p style="margin-bottom: var(--space-6);">${project.role}</p>
          
          <h3 style="margin-bottom: var(--space-3); color: var(--color-text-primary);">Tech Stack:</h3>
          <div style="display: flex; flex-wrap: wrap; gap: var(--space-2); margin-bottom: var(--space-6);">
            ${project.techStack
              .map(
                (tech) => `
              <span style="font-size: var(--font-size-sm); background-color: var(--color-bg-secondary); padding: var(--space-2) var(--space-4); border-radius: var(--border-radius-md); border: 1px solid var(--color-border);">
                ${tech}
              </span>
            `
              )
              .join('')}
          </div>
          
          <h3 style="margin-bottom: var(--space-3); color: var(--color-text-primary);">Key Achievements:</h3>
          <ul style="list-style: disc; padding-left: var(--space-6); margin-bottom: var(--space-6); line-height: var(--line-height-relaxed);">
            ${project.achievements.map((achievement) => `<li style="margin-bottom: var(--space-2);">${achievement}</li>`).join('')}
          </ul>
          
          <div style="display: flex; gap: var(--space-4); flex-wrap: wrap;">
            ${
              project.githubUrl
                ? `
              <a href="${project.githubUrl}" target="_blank" rel="noopener noreferrer" 
                 style="display: inline-flex; align-items: center; gap: var(--space-2); padding: var(--space-3) var(--space-5); background-color: var(--color-accent); color: var(--color-bg-dark); border-radius: var(--border-radius-md); font-weight: var(--font-weight-semibold); text-decoration: none;">
                View on GitHub
              </a>
            `
                : ''
            }
            ${
              project.demoUrl
                ? `
              <a href="${project.demoUrl}" target="_blank" rel="noopener noreferrer"
                 style="display: inline-flex; align-items: center; gap: var(--space-2); padding: var(--space-3) var(--space-5); background-color: var(--color-primary); color: white; border-radius: var(--border-radius-md); font-weight: var(--font-weight-semibold); text-decoration: none;">
                View Live Demo
              </a>
            `
                : ''
            }
          </div>
        `;

          projectModal.setContent(content);
          projectModal.open();
        }
      });
    });
  }); // Close DOMContentLoaded
</script>
